<header class="header">
    <!-- Top Row: Logo + User Actions -->
    <div class="header-top d-flex w-100 justify-content-between align-items-center">
        <!-- Mobile Hamburger Menu -->
        <div class="mobile-hamburger">
            <button mat-icon-button class="hamburger-btn" (click)="toggleSideMenu()">
                <mat-icon>menu</mat-icon>
            </button>
        </div>

        <!-- Logo -->
        <div class="flex-grow-1 logo-section">
            <a routerLink="/" class="logo-link">
                <img src="assets/Logo.png" alt="E-Commerce Logo" class="logo" />
            </a>
        </div>

        <!-- Desktop Search Bar -->
        <div class="flex-grow-5 align-items-center desktop-search">
            <div class="search-container">
                <app-search-bar (searchSelected)="handleSearchResult($event)"></app-search-bar>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex-grow-1 actions-section">
            <div *ngIf="isSellerLogin" class="account-btn-container">
                <button mat-icon-button class="account-btn" routerLink="/product-card">
                    <span class="add-product-text">Add Product</span>
                </button>
            </div>
            <div *ngIf="!(isBuyerLogin || isSellerLogin)" class="account-btn-container hideForMobile">
                <button mat-icon-button class="account-btn" [class.logged-in]="isBuyerLogin || isSellerLogin"
                    routerLink="/sellerSignup">
                    <mat-icon class="account-icon">account_circle</mat-icon>
                    <span class="login-text" *ngIf="!(isBuyerLogin || isSellerLogin)">Become Seller</span>
                </button>
            </div>

            <ng-container *ngIf="!isSellerLogin">
                <app-cart-icon></app-cart-icon>
            </ng-container>

            <div class="account-btn-container" (mouseenter)="onAccountBtnHover()" (mouseleave)="onAccountBtnLeave()">
                <button mat-icon-button [matMenuTriggerFor]="userMenu" #menuTrigger="matMenuTrigger" class="account-btn"
                    (click)="onAccountBtnClick()" [class.logged-in]="isBuyerLogin || isSellerLogin">
                    <mat-icon class="account-icon">account_circle</mat-icon>
                    <span class="login-text" *ngIf="!(isBuyerLogin || isSellerLogin)">Login</span>
                </button>
            </div>

            <mat-menu #userMenu="matMenu" class="enhanced-menu" [overlapTrigger]="false"
                (mouseenter)="onMenuMouseEnter()" (mouseleave)="onMenuMouseLeave()">
                <ng-container *ngIf="isBuyerLogin || isSellerLogin; else loginOption">
                    <div class="user-info">
                        <div class="user-avatar">
                            <mat-icon>account_circle</mat-icon>
                        </div>
                        <div class="user-details">
                            <strong>{{ userEmail }}</strong>
                            <span class="user-status">Online</span>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                    <button mat-menu-item (click)="goToMyAccount()" class="menu-item">
                        <mat-icon>person</mat-icon>
                        <span>My Account</span>
                    </button>
                    <button mat-menu-item (click)="goToMyOrders()" class="menu-item">
                        <mat-icon>shopping_bag</mat-icon>
                        <span>My Orders</span>
                    </button>
                    <mat-divider></mat-divider>
                    <button mat-menu-item (click)="logout()" class="menu-item logout-btn">
                        <mat-icon>logout</mat-icon>
                        <span>Logout</span>
                    </button>
                </ng-container>
                <ng-template #loginOption>
                    <button mat-menu-item routerLink="/buyerSignup" class="menu-item login-menu-btn">
                        <mat-icon>person</mat-icon>
                        <span>New Customer?</span>
                    </button>
                </ng-template>
            </mat-menu>
        </div>
    </div>

    <!-- Mobile Search Bar -->
    <div class="header-bottom mobile-search">
        <div class="search-container-mobile">
            <app-search-bar (searchSelected)="handleSearchResult($event)"></app-search-bar>
        </div>
    </div>
</header>

<!-- Mobile Side Menu Overlay -->
<div class="side-menu-overlay" [class.active]="isSideMenuOpen" (click)="closeSideMenu()"></div>

<!-- Mobile Side Menu -->
<div class="side-menu" [class.active]="isSideMenuOpen">
    <div class="side-menu-header">
        <button mat-icon-button class="close-btn" (click)="closeSideMenu()">
            <mat-icon>close</mat-icon>
        </button>
        <h3>Menu</h3>
    </div>

    <div class="side-menu-content">
        <div class="side-menu-user" *ngIf="isBuyerLogin || isSellerLogin">
            <div class="user-avatar-side">
                <mat-icon>account_circle</mat-icon>
            </div>
            <div class="user-details-side">
                <strong>{{ userEmail }}</strong>
                <span class="user-status">Online</span>
            </div>
        </div>

        <mat-divider></mat-divider>

        <nav class="side-menu-nav">
            <a class="side-menu-item" (click)="navigateTo('/sellerSignup'); closeSideMenu()">
                <mat-icon>storefront</mat-icon>
                <span>Become Seller</span>
            </a>
            <a *ngIf="isSellerLogin" class="side-menu-item" (click)="navigateTo('/product-card'); closeSideMenu()">
                <mat-icon>add_box</mat-icon>
                <span>Add Product</span>
            </a>
            <a class="side-menu-item" (click)="navigateTo('/top-offers'); closeSideMenu()">
                <mat-icon>local_offer</mat-icon>
                <span>Top Offers</span>
            </a>

            <ng-container *ngIf="isBuyerLogin || isSellerLogin">
                <a class="side-menu-item" (click)="goToMyAccount(); closeSideMenu()">
                    <mat-icon>person</mat-icon>
                    <span>My Account</span>
                </a>

                <a class="side-menu-item" (click)="goToMyOrders(); closeSideMenu()">
                    <mat-icon>shopping_bag</mat-icon>
                    <span>My Orders</span>
                </a>
            </ng-container>

            <ng-container *ngIf="!(isBuyerLogin || isSellerLogin)">
                <a class="side-menu-item" (click)="navigateTo('/buyerLogin'); closeSideMenu()">
                    <mat-icon>login</mat-icon>
                    <span>Login</span>
                </a>

                <a class="side-menu-item" (click)="navigateTo('/buyerSignup'); closeSideMenu()">
                    <mat-icon>person_add</mat-icon>
                    <span>New Customer?</span>
                </a>
            </ng-container>

            <ng-container *ngIf="isBuyerLogin || isSellerLogin">
                <mat-divider></mat-divider>
                <a class="side-menu-item logout-side" (click)="logout(); closeSideMenu()">
                    <mat-icon>logout</mat-icon>
                    <span>Logout</span>
                </a>
            </ng-container>
        </nav>
    </div>
</div>